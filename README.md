# EDS

Это набор файлов для создания задачи на подлкючение виртуального диска для хранения ЭЦП.
Решение было придумано для реализации на терминальном сервере, для доступа к ЭЦП нескольких сотрудников одновременно. Сотрудники для рабоыт с ЭЦП подключаются к серверу и работают с ЭЦП только на нем.

Как реализуется:
1) Создаем группы в AD, которыми мы будем давать доступ к соответсвующим ЭЦП.
2) Создается виртуальный диск .vhd (можно через оснастку "Диспетчер дисков" или PS), объемом 32 МБ, этого хватит.
3) Виртуальный диск переименовывается на EDS.vhd и перемещается в C:\Windows\. Туда доступ будет только у Администраторов и Системы. Никто не копирует виртуальный диск с ЭЦП.
4) Подключение диска EDS.xml закидывается в корень C:\.
5) От имени администратора запускается PS и выполняется скрипт/командлет в Add-Schedule.ps1.
6) Подключаем недавно созданный диск вручную, форматируем его на NTFS.
7) Копируем в него неэкспортируемые ЭЦП в виде файла. Редактируем параметры доступа к каждой папке с ЭЦП даем права на чтение и запись администратрам, системе и созданной в п.1 соответствующей группе.
8) Политиками запрещаем отображение в проводнике диска A: и B:, а также доступ из проводника к этим дискам. Если усдановлена политика, запрещающая пользователям пользоваться приложениями, находящимися у них в профиле, то сертификаты возможно достать только через консоль.
9) Перезагружаем сервер.

Также можно добавить при выходе пользователя из системы выполнение скрипта Delete-Cert.cmd. Он в тихом режиме удаляет все сертификаты от ЭЦП, установленные в хранилище профиля пользователя.
Install-Cert.cmd можно добавить на вход пользователя в систему. Тогда сертификаты со всех доступных ЭЦП на сервере будут устанавливаться с привязкой к закрытому ключу в локальное хранилище пользователя.
